<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <title>Kuro Open Winter 2026 - Gi·∫£i c·∫ßu l√¥ng m·ªü r·ªông</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- FAVICON: icon tr√°i c·∫ßu l√¥ng -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
  <!-- (tu·ª≥ ch·ªçn) cho iPhone/iPad -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />


  <style>
    :root {
      --primary: #4fd1ff;
      --primary-soft: rgba(79, 209, 255, 0.25);
      --accent: #ff9cf5;
      --bg-dark: rgba(4, 10, 30, 0.92);
      --card-bg: rgba(7, 16, 40, 0.82);
      --border-soft: rgba(255, 255, 255, 0.18);
      --text-main: #f8fafc;
      --text-soft: #cbd5f5;
      --blur: 22px;
      --radius-card: 22px;
      --shadow-strong: 0 25px 60px rgba(0, 0, 0, 0.9);
      --transition-fast: 0.2s ease-out;
      --transition-med: 0.35s ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
      scroll-behavior: smooth;
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-main);
      background-image: url("https://th.bing.com/th/id/R.45cb163a32239427adef3815f0c30e04?rik=4AS5m9cEXd9Fzw&pid=ImgRaw&r=0");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(79, 209, 255, 0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(255, 156, 245, 0.18), transparent 55%),
        linear-gradient(to bottom, rgba(3, 7, 18, 0.55), rgba(15, 23, 42, 0.72));
      backdrop-filter: blur(4px);
      z-index: -1;
    }

    header.hero {
      min-height: 100vh;
      padding: 24px 7vw 60px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 40px;
    }

    .logo {
      font-weight: 700;
      font-size: 1.3rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo span {
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 255, 0.6);
      background: radial-gradient(circle at top left, rgba(148, 163, 255, 0.35), transparent 55%);
      font-size: 0.7rem;
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 26px;
      font-size: 0.95rem;
    }

    .nav-links a {
      color: var(--text-soft);
      text-decoration: none;
      position: relative;
      padding-bottom: 4px;
      transition: color var(--transition-fast);
    }

    .nav-links a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transition: width var(--transition-med);
    }

    .nav-links a:hover {
      color: #ffffff;
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    .hero-main {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 40px;
      align-items: center;
    }

    .hero-text .tag {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
      margin-bottom: 12px;
    }

    .hero-text h1 {
      font-size: clamp(2.6rem, 4vw, 3.4rem);
      line-height: 1.1;
      margin-bottom: 14px;
      background: linear-gradient(120deg, #ffffff, #e5f6ff, #a5b4fc);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .hero-text .subtitle {
      font-size: 0.95rem;
      color: var(--text-soft);
      margin-bottom: 22px;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 26px;
    }

    .badge-chip {
      font-size: 0.78rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 255, 0.6);
      padding: 6px 12px;
      background: radial-gradient(circle at top left, rgba(79, 209, 255, 0.15), transparent 55%);
      backdrop-filter: blur(12px);
    }

    .countdown-wrap {
      margin-bottom: 26px;
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    .countdown {
      margin-top: 6px;
      display: inline-flex;
      gap: 12px;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 255, 0.5);
      background: radial-gradient(circle at top left, rgba(79, 209, 255, 0.22), transparent 55%);
      box-shadow: 0 0 20px rgba(79, 209, 255, 0.25);
      font-size: 0.86rem;
    }

    .count-segment {
      text-align: center;
      min-width: 55px;
    }

    .count-number {
      font-weight: 600;
      font-size: 1rem;
      display: block;
    }

    .count-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .btn {
      border-radius: 999px;
      padding: 10px 20px;
      border: 1px solid transparent;
      font-size: 0.9rem;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast);
      position: relative;
      overflow: hidden;
      user-select: none;
      white-space: nowrap;
    }

    .btn.primary {
      background: linear-gradient(120deg, var(--primary), #a5b4fc);
      color: #020617;
      box-shadow: 0 14px 30px rgba(56, 189, 248, 0.55);
    }

    .btn.primary:hover {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 18px 40px rgba(56, 189, 248, 0.7);
    }

    .btn.ghost {
      background: transparent;
      color: var(--text-main);
      border-color: rgba(148, 163, 255, 0.6);
      backdrop-filter: blur(14px);
    }

    .btn.ghost:hover {
      background: rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
      border-color: rgba(191, 219, 254, 0.8);
    }

    .btn:disabled {
      opacity: .5;
      cursor: not-allowed;
      transform: none !important;
    }

    .hero-visual {
      position: relative;
      padding: 20px;
    }

    .hero-card {
      border-radius: 26px;
      padding: 20px;
      background: radial-gradient(circle at top left, rgba(79, 209, 255, 0.32), transparent 55%),
        radial-gradient(circle at bottom right, rgba(255, 156, 245, 0.3), transparent 55%),
        var(--card-bg);
      border: 1px solid var(--border-soft);
      backdrop-filter: blur(var(--blur));
      box-shadow: var(--shadow-strong);
      position: relative;
      overflow: hidden;
    }

    .hero-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: conic-gradient(from 180deg, rgba(56, 189, 248, 0.18), transparent, rgba(244, 114, 182, 0.15), transparent);
      opacity: 0.6;
      mix-blend-mode: screen;
      animation: rotateGlow 12s linear infinite;
    }

    .hero-card-inner {
      position: relative;
      z-index: 1;
    }

    .hero-card-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-bottom: 8px;
      color: var(--text-soft);
    }

    .hero-card-big {
      font-size: 1.6rem;
      margin-bottom: 14px;
      font-weight: 600;
    }

    .hero-card-detail {
      font-size: 0.82rem;
      color: var(--text-soft);
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
    }

    .hero-mini-table {
      margin-top: 12px;
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 255, 0.5);
      font-size: 0.78rem;
    }

    .hero-mini-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px dashed rgba(148, 163, 255, 0.25);
    }

    .hero-mini-row:last-child {
      border-bottom: none;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.74rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34, 197, 94, 0.7);
      background: rgba(22, 163, 74, 0.18);
      margin-top: 10px;
    }

    .glow-orb {
      position: absolute;
      border-radius: 999px;
      filter: blur(18px);
      opacity: 0.7;
      pointer-events: none;
    }

    .orb-1 {
      width: 120px;
      height: 120px;
      background: rgba(59, 130, 246, 0.7);
      top: -10px;
      right: -30px;
      animation: floatOrb 8s ease-in-out infinite alternate;
    }

    .orb-2 {
      width: 90px;
      height: 90px;
      background: rgba(248, 250, 252, 0.9);
      bottom: -20px;
      left: -20px;
      animation: floatOrb 10s ease-in-out infinite alternate-reverse;
    }

    @keyframes rotateGlow {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes floatOrb {
      to {
        transform: translate3d(20px, -20px, 0) scale(1.1);
        opacity: 0.85;
      }
    }

    main {
      padding: 0 7vw 60px;
    }

    section.section {
      margin-top: 32px;
      padding: 40px 0 10px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 18px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .section-header h2 {
      font-size: 1.6rem;
    }

    .section-header p {
      font-size: 0.9rem;
      color: var(--text-soft);
      max-width: 520px;
    }

    .section-tag {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .glass-card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-strong);
      backdrop-filter: blur(var(--blur));
      padding: 22px 22px 18px;
      position: relative;
      overflow: hidden;
    }

    .glass-card::before {
      content: "";
      position: absolute;
      inset: -20%;
      opacity: 0;
      pointer-events: none;
      background: radial-gradient(circle at top left, rgba(79, 209, 255, 0.3), transparent 60%);
      transition: opacity var(--transition-med);
    }

    .glass-card:hover::before {
      opacity: 1;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.86rem;
    }

    thead {
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.45), rgba(129, 140, 248, 0.55));
    }

    th,
    td {
      padding: 9px 10px;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.78rem;
      letter-spacing: 0.08em;
    }

    tbody tr {
      border-bottom: 1px solid rgba(148, 163, 255, 0.18);
      background: linear-gradient(90deg, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.85));
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    tbody tr:nth-child(odd) {
      background: linear-gradient(90deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.78));
    }

    tbody tr:hover {
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.16), rgba(15, 23, 42, 0.96));
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.9);
    }

    .score-highlight {
      color: #bef264;
      font-weight: 500;
    }

    .pill-mini {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 255, 0.45);
      background: rgba(15, 23, 42, 0.65);
      font-size: .82rem;
      opacity: .95;
    }

    .winner-label {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      border-radius: 12px;
      background: rgba(79, 209, 255, 0.15);
      color: #4fd1ff;
      font-weight: bold;
    }

    .danger-label {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      border-radius: 12px;
      background: rgba(255, 107, 107, 0.14);
      color: #ff8a8a;
      font-weight: 600;
    }

    .fade-in {
      opacity: 0;
      transform: translateY(24px);
      transition: opacity 0.7s ease-out, transform 0.7s ease-out;
    }

    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Mobile responsive table to cards */
    @media (max-width: 768px) {

      .schedule-table,
      .schedule-table thead,
      .schedule-table tbody,
      .schedule-table th,
      .schedule-table td,
      .schedule-table tr {
        display: block;
        width: 100%;
      }

      .schedule-table thead {
        display: none;
      }

      .schedule-table tr {
        background: rgba(255, 255, 255, 0.05);
        margin-bottom: 15px;
        padding: 12px 14px;
        border-radius: 14px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
        transition: transform 0.2s ease;
      }

      .schedule-table tr:hover {
        transform: scale(1.01);
        background: rgba(255, 255, 255, 0.08);
      }

      .schedule-table td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 10px;
        font-size: 14px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        white-space: normal;
      }

      .schedule-table td:last-child {
        border-bottom: none;
      }

      .schedule-table td::before {
        content: attr(data-label);
        font-weight: 600;
        color: #4fd1ff;
        margin-right: 10px;
        flex: 0 0 auto;
      }
    }

    .players-section {
      padding: 60px 7vw;
      text-align: center;
    }

    .player-card {
      display: flex;
      align-items: center;
      gap: 25px;
      margin: 30px auto;
      padding: 25px;
      max-width: 800px;
      background: rgba(7, 16, 40, 0.82);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
      transition: transform 0.3s ease, box-shadow 0.4s ease;
    }

    .player-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 25px 60px rgba(0, 0, 0, 0.9);
    }

    .player-photo {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgba(79, 209, 255, 0.5);
    }

    .player-info h3 {
      font-size: 1.3rem;
      margin-bottom: 8px;
    }

    .player-info span {
      font-size: 0.85rem;
      color: var(--primary);
      font-weight: 400;
    }

    .player-info p {
      color: var(--text-soft);
      font-size: 0.92rem;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .player-card {
        flex-direction: column;
        text-align: center;
      }
    }

    .score-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .hero-main {
        grid-template-columns: minmax(0, 1fr);
      }

      .score-layout {
        grid-template-columns: minmax(0, 1fr);
      }

      header.hero {
        padding-top: 16px;
      }

      .nav {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .nav-links {
        gap: 18px;
      }
    }

    .rules-list {
      font-size: 0.86rem;
      color: var(--text-soft);
      line-height: 1.6;
      padding-left: 18px;
    }

    .rules-list li {
      margin-bottom: 6px;
    }

    .rules-footnote {
      margin-top: 10px;
      font-size: 0.8rem;
      color: #e5e7eb;
      opacity: 0.9;
    }

    .score-note {
      font-size: 0.78rem;
      color: rgba(226, 232, 240, 0.9);
      margin-top: 8px;
    }

    .counter {
      font-variant-numeric: tabular-nums;
    }

    footer {
      background: rgba(10, 15, 35, 0.92);
      padding: 50px 7vw;
      border-top: 1px solid rgba(148, 163, 255, 0.25);
      backdrop-filter: blur(18px);
      color: #e5e7eb;
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 40px;
    }

    .footer-info h3 {
      font-size: 1.4rem;
      margin-bottom: 10px;
      color: #f8fafc;
    }

    .footer-contact ul {
      list-style: none;
      padding: 0;
    }

    .footer-contact a {
      color: #cbd5f5;
      font-size: 0.9rem;
      text-decoration: none;
      display: block;
      margin-bottom: 8px;
      transition: color 0.3s ease;
    }

    .footer-contact a i {
      margin-right: 8px;
      color: #70e4ff;
    }

    .footer-contact a:hover {
      color: #ffffff;
    }

    .social-icons a {
      font-size: 1.4rem;
      margin-right: 15px;
      color: #cbd5f5;
      text-decoration: none;
      transition: transform 0.3s ease, filter 0.3s ease, color 0.3s ease;
    }

    .social-icons a:hover {
      transform: scale(1.2);
      color: #ffffff;
      filter: drop-shadow(0 0 6px #4fd1ff);
    }

    .copyright {
      margin-top: 12px;
      font-size: 0.85rem;
      color: #94a3b8;
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, .55);
    }

    dialog input,
    dialog select {
      background: rgba(15, 23, 42, .9);
      border: 1px solid rgba(148, 163, 255, .35);
      color: var(--text-main);
      outline: none;
    }
    .table-scroll{
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.score-table{
  min-width: 1000px; /* v√¨ b·∫°n c√≥ 11 c·ªôt, n√™n ƒë·ªÉ r·ªông h∆°n */
}

  </style>
</head>

<body>
  <header class="hero" id="top">
    <nav class="nav">
      <div class="logo">
        Kuro Open
        <span>Winter 2026</span>
      </div>
      <ul class="nav-links">
        <li><a href="#live-scoreboard">L·ªãch thi ƒë·∫•u</a></li>
        <li><a href="#standings">B·∫£ng x·∫øp h·∫°ng</a></li>
        <li><a href="#bracket">Playoff</a></li>
        <li><a href="#players">V·∫≠n ƒë·ªông vi√™n</a></li>
        <li><a href="#scoring">C√°ch t√≠nh ƒëi·ªÉm</a></li>
      </ul>
    </nav>

    <div class="hero-main">
      <div class="hero-text">
        <p class="tag">Gi·∫£i c·∫ßu l√¥ng m·ªü r·ªông</p>
        <h1>Kuro Open Winter 2026</h1>
        <p class="subtitle">
          Ng√†y <strong>01/01/2026</strong> ‚Ä¢ Nh√† thi ƒë·∫•u TDT B√πi X∆∞∆°ng Tr·∫°ch ‚Ä¢ Th·ªÉ th·ª©c v√≤ng tr√≤n 5 ng∆∞·ªùi ‚Üí b√°n k·∫øt ‚Üí
          chung k·∫øt
        </p>

        <div class="hero-badges">
          <div class="badge-chip">ƒê∆°n nam phong tr√†o</div>
          <div class="badge-chip">Live t√≠nh set &amp; ƒëi·ªÉm</div>
          <div class="badge-chip">Top 4 v√†o b√°n k·∫øt</div>
        </div>

        <div class="countdown-wrap">
          <span>ƒê·∫øm ng∆∞·ª£c t·ªõi gi·ªù khai m·∫°c:</span>
          <div id="countdown" class="countdown"></div>
        </div>

        <div class="hero-actions">
          <a href="#live-scoreboard" class="btn primary">Xem l·ªãch thi ƒë·∫•u</a>
          <a href="#scoring" class="btn ghost">V√≠ d·ª• c√°ch t√≠nh ƒëi·ªÉm</a>
        </div>
      </div>

      <div class="hero-visual">
        <div class="hero-card">
          <div class="hero-card-inner">
            <div class="hero-card-title">B·∫£ng ƒë·∫•u Kuro</div>
            <div class="hero-card-big">5 tay v·ª£t ‚Äì 10 tr·∫≠n ‚Äì Top 4 v√†o b√°n k·∫øt</div>

            <div class="hero-card-detail">
              <span><strong>Th·ªùi gian:</strong> 01/01/2026</span>
              <span><strong>Th·ªÉ th·ª©c:</strong> RR ‚Üí BK ‚Üí CK</span>
            </div>

            <div class="hero-mini-table">
              <div class="hero-mini-row">
                <span>BK</span>
                <span>H1 vs H4 ‚Ä¢ H2 vs H3</span>
              </div>
              <div class="hero-mini-row">
                <span>Tiebreak</span>
                <span>ƒêi·ªÉm tr·∫≠n ‚Üí ƒë·ªëi ƒë·∫ßu ‚Üí HS set ‚Üí HS ƒëi·ªÉm</span>
              </div>
              <div class="hero-mini-row">
                <span>Qu·∫£n tr·ªã</span>
                <span>Admin kho√°/m·ªü nh·∫≠p ƒëi·ªÉm</span>
              </div>
              <div class="hero-mini-row">
                <span>D·ªØ li·ªáu</span>
                <span>LocalStorage + Export/Import</span>
              </div>
            </div>

            <div class="pill">üî• Live scoreboard ‚Ä¢ Bracket t·ª± sinh ‚Ä¢ C√≥ WO/RET</div>
          </div>
          <span class="glow-orb orb-1"></span>
          <span class="glow-orb orb-2"></span>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- LIVE SCOREBOARD -->
    <div id="live-scoreboard" class="glass-card">
      <div style="display:flex; gap:12px; justify-content:space-between; align-items:center; flex-wrap:wrap;">
        <div style="display:flex; flex-direction:column; gap:6px;">
          <h3 style="margin:0;">üìä Live Scoreboard - Kuro Open Winter 2026</h3>
          <div id="status-pill" class="pill-mini"></div>
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <select id="player-filter" class="btn ghost" style="padding:10px 14px;">
            <option value="ALL">T·∫•t c·∫£ VƒêV</option>
          </select>

          <button class="btn ghost" id="btn-sync" type="button">Sync t·ª´ Google Sheet</button>
          <button class="btn ghost" id="btn-lock" type="button">Ch·ªët v√≤ng b·∫£ng: T·∫Øt</button>

          <button class="btn ghost" id="btn-reset" type="button">Reset d·ªØ li·ªáu</button>
          <button class="btn ghost" id="btn-export" type="button">Export JSON</button>
          <button class="btn ghost" id="btn-admin" type="button">Admin: Kho√°</button>

          <label class="btn ghost" style="cursor:pointer;">
            Import JSON <input type="file" id="file-import" accept="application/json" hidden>
          </label>
        </div>
      </div>

      <p style="margin:10px 0 0; opacity:.85;">
        V√≤ng b·∫£ng: <strong>Top 4</strong> v√†o b√°n k·∫øt (1-4, 2-3). X·∫øp h·∫°ng theo:
        <strong>ƒêi·ªÉm tr·∫≠n</strong> ‚Üí <strong>ƒê·ªëi ƒë·∫ßu</strong> ‚Üí <strong>Hi·ªáu s·ªë set</strong> ‚Üí <strong>Hi·ªáu s·ªë
          ƒëi·ªÉm</strong>.
      </p>

      <table class="schedule-table" id="score-table" style="margin-top:12px;">
        <thead>
          <tr>
            <th>Giai ƒëo·∫°n</th>
            <th>V√≤ng</th>
            <th>Tr·∫≠n</th>
            <th>Set 1</th>
            <th>Set 2</th>
            <th>Set 3</th>
            <th>Ng∆∞·ªùi th·∫Øng</th>
            <th>Ghi ch√∫</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody id="score-data">
          <tr>
            <td colspan="9">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- STANDINGS -->
    <section id="standings" class="section fade-in">
  <div class="glass-card">
    <h3 style="margin:0 0 10px;">üèÜ B·∫£ng x·∫øp h·∫°ng v√≤ng b·∫£ng</h3>

    <div class="table-scroll">
      <table class="score-table" id="standings-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Ng∆∞·ªùi ch∆°i</th>
            <th>ƒêi·ªÉm tr·∫≠n</th>
            <th>Th·∫Øng</th>
            <th>Thua</th>
            <th>Set th·∫Øng</th>
            <th>Set thua</th>
            <th>HS set</th>
            <th>ƒêi·ªÉm ghi</th>
            <th>ƒêi·ªÉm thua</th>
            <th>HS ƒëi·ªÉm</th>
          </tr>
        </thead>
        <tbody id="standings-body"></tbody>
      </table>
    </div>

    <p style="margin:10px 0 0; opacity:.85;">
      Khi ƒë·ªß k·∫øt qu·∫£ v√≤ng b·∫£ng, h·ªá th·ªëng t·ª± sinh b√°n k·∫øt &amp; chung k·∫øt.
    </p>
  </div>
</section>


    <!-- BRACKET -->
    <section id="bracket" class="section fade-in">
      <div class="glass-card">
        <h3 style="margin:0 0 10px;">ü•á B√°n k·∫øt - Chung k·∫øt</h3>

        <div style="display:grid; grid-template-columns:1fr; gap:12px;">
          <div>
            <h4 style="margin:0 0 8px;">B√°n k·∫øt</h4>
            <div id="semis-wrap"></div>
          </div>

          <div>
            <h4 style="margin:0 0 8px;">Chung k·∫øt</h4>
            <div id="final-wrap"></div>
          </div>

          <div>
            <h4 style="margin:0 0 8px;">Tranh h·∫°ng 3 (tu·ª≥ ch·ªçn)</h4>
            <div id="third-wrap"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- SCORE INPUT MODAL -->
    <dialog id="score-dialog" style="max-width:560px; width:92%; border:none; border-radius:14px; padding:0;">
      <form method="dialog" style="padding:14px 14px 10px;">
        <h3 id="dlg-title" style="margin:0 0 8px;">Nh·∫≠p t·ªâ s·ªë</h3>
        <p id="dlg-sub" style="margin:0 0 12px; opacity:.85;"></p>

        <div style="display:grid; gap:10px;">
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div>
              <label style="font-size:.9rem; opacity:.9;">Set 1 (A-B)</label>
              <input id="s1" placeholder="21-18" style="width:100%; padding:10px; border-radius:10px;">
            </div>
            <div>
              <label style="font-size:.9rem; opacity:.9;">Set 2 (A-B)</label>
              <input id="s2" placeholder="17-21" style="width:100%; padding:10px; border-radius:10px;">
            </div>
          </div>

          <div>
            <label style="font-size:.9rem; opacity:.9;">Set 3 (A-B) (n·∫øu c√≥)</label>
            <input id="s3" placeholder="21-19" style="width:100%; padding:10px; border-radius:10px;">
          </div>

          <div style="display:grid; gap:10px; margin-top:8px;">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
              <div>
                <label style="font-size:.9rem; opacity:.9;">Lo·∫°i k·∫øt qu·∫£</label>
                <select id="result-type" style="width:100%; padding:10px; border-radius:10px;">
                  <option value="NORMAL">B√¨nh th∆∞·ªùng</option>
                  <option value="WO">WO (b·ªè cu·ªôc)</option>
                  <option value="RET">RET (ch·∫•n th∆∞∆°ng)</option>
                </select>
              </div>
              <div>
                <label style="font-size:.9rem; opacity:.9;">Ch·ªçn ng∆∞·ªùi th·∫Øng (WO/RET)</label>
                <select id="forced-winner" style="width:100%; padding:10px; border-radius:10px;">
                  <option value="A">Ng∆∞·ªùi A</option>
                  <option value="B">Ng∆∞·ªùi B</option>
                </select>
              </div>
            </div>

            <div>
              <label style="font-size:.9rem; opacity:.9;">Ghi ch√∫</label>
              <input id="note" placeholder="VD: Delay 10p / WO / RET..."
                style="width:100%; padding:10px; border-radius:10px;">
            </div>
          </div>

          <p id="dlg-error" style="margin:0; color:#ff6b6b; display:none;"></p>
        </div>

        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
          <button class="btn ghost" id="dlg-clear" type="button">Xo√° t·ªâ s·ªë</button>
          <button class="btn ghost" value="cancel">Hu·ª∑</button>
          <button class="btn primary" id="dlg-save" value="default">L∆∞u</button>
        </div>
      </form>
    </dialog>

    <!-- PLAYERS -->
    <section id="players" class="players-section">
      <h2>5 chi·∫øn binh nh√† Kuro</h2>
      <p class="section-subtitle">M·ªói ng∆∞·ªùi m·ªôt phong c√°ch ‚Äì Ai s·∫Ω l√† nh√† v√¥ ƒë·ªãch Kuro Open Winter?</p>

      <div class="player-card">
        <img src="./img/z7238788029070_fbe3bf347e7e5570e3deb86f3b43c6df.jpg" class="player-photo">
        <div class="player-info">
          <h3>AnKuro <span>‚Ä¢ To√†n di·ªán ‚Äì ki·ªÉm so√°t tr·∫≠n ƒë·∫•u</span></h3>
          <p>S·ªü h·ªØu b∆∞·ªõc ch√¢n linh ho·∫°t, chuy√™n b·∫Øt b√†i v√† ph·∫£n c√¥ng b·∫•t ng·ªù ·ªü cu·ªëi set.</p>
        </div>
      </div>

      <div class="player-card">
        <img src="./img/z7238788029590_18135496fc86f324c7b9b2d03f87463f.jpg" class="player-photo">
        <div class="player-info">
          <h3>ƒê·ª©cKuro <span>‚Ä¢ T·∫•n c√¥ng m·∫°nh ‚Äì Smash uy l·ª±c</span></h3>
          <p>Smash nh∆∞ s√©t ƒë√°nh, th√≠ch k√©o pha b√≥ng l√™n cao r·ªìi d·ªìn ƒë·ªëi th·ªß v√†o g√≥c s√¢n.</p>
        </div>
      </div>

      <div class="player-card">
        <img src="./img/z7238788308541_6354bc98eb00357f875164b179409902.jpg" class="player-photo">
        <div class="player-info">
          <h3>Ki√™nKuro <span>‚Ä¢ B·ªÅn b·ªâ ‚Äì l√¨ l·ª£m</span></h3>
          <p>Kh√¥ng v·ªôi k·∫øt th√∫c, ch·ªù ƒë·ªëi th·ªß m·∫Øc sai l·∫ßm. C√†ng ƒë√°nh l√¢u c√†ng nguy hi·ªÉm.</p>
        </div>
      </div>

      <div class="player-card">
        <img src="./img/z7238788028411_90e318ef2c22b07d5e6b842fadaec364.jpg" class="player-photo">
        <div class="player-info">
          <h3>Ho√°nKuro <span>‚Ä¢ K·ªπ thu·∫≠t ‚Äì xoay c·ªï tay</span></h3>
          <p>C·∫ßu ng·∫Øn, c·∫Øt l∆∞·ªõi, b·ªè nh·ªè‚Ä¶ ƒë·ªß chi√™u ƒë·ªÉ khi·∫øn ƒë·ªëi th·ªß ph·∫£i ch·∫°y ‚Äúch√°y ph·ªïi‚Äù.</p>
        </div>
      </div>

      <div class="player-card">
        <img src="./img/z7238788028452_047008e38afb300c7ed524fb352bc698.jpg" class="player-photo">
        <div class="player-info">
          <h3>QuangKuro <span>‚Ä¢ Chi·∫øn thu·∫≠t ‚Äì ƒë·ªçc t√¨nh hu·ªëng</span></h3>
          <p>T·∫≠p trung v√†o ƒëi·ªÅu nh·ªãp tr·∫≠n ƒë·∫•u v√† ki·ªÉm so√°t t·ª´ng pha c·∫ßu.</p>
        </div>
      </div>
    </section>

    <!-- SCORING (demo content gi·ªØ nguy√™n) -->
    <section id="scoring" class="section fade-in">
      <div class="section-header">
        <div>
          <div class="section-tag">V√≠ d·ª• c√°ch t√≠nh ƒëi·ªÉm</div>
          <h2>B·∫£ng x·∫øp h·∫°ng &amp; hi·ªáu s·ªë</h2>
        </div>
        <p>
          V√≤ng b·∫£ng t√≠nh theo <strong>ƒêi·ªÉm tr·∫≠n</strong> (th·∫Øng = 2, thua = 0),
          sau ƒë√≥ ƒë·∫øn <strong>ƒë·ªëi ƒë·∫ßu</strong>, <strong>hi·ªáu s·ªë set</strong>, r·ªìi <strong>hi·ªáu s·ªë ƒëi·ªÉm</strong>.
        </p>
      </div>

      <div class="score-layout">
        <div class="glass-card">
          <table class="score-table">
            <thead>
              <tr>
                <th>Ng∆∞·ªùi ch∆°i</th>
                <th>Tr·∫≠n th·∫Øng</th>
                <th>Set th·∫Øng</th>
                <th>Set thua</th>
                <th>Hi·ªáu s·ªë set</th>
                <th>ƒêi·ªÉm ghi</th>
                <th>ƒêi·ªÉm thua</th>
                <th>Hi·ªáu s·ªë ƒëi·ªÉm</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>QuangKuro</td>
                <td><span class="counter" data-count="3">0</span></td>
                <td><span class="counter" data-count="6">0</span></td>
                <td><span class="counter" data-count="2">0</span></td>
                <td class="score-highlight">+4</td>
                <td><span class="counter" data-count="168">0</span></td>
                <td><span class="counter" data-count="142">0</span></td>
                <td class="score-highlight">+26</td>
              </tr>
              <tr>
                <td>ƒê·ª©cKuro</td>
                <td><span class="counter" data-count="2">0</span></td>
                <td><span class="counter" data-count="5">0</span></td>
                <td><span class="counter" data-count="4">0</span></td>
                <td class="score-highlight">+1</td>
                <td><span class="counter" data-count="182">0</span></td>
                <td><span class="counter" data-count="176">0</span></td>
                <td class="score-highlight">+6</td>
              </tr>
              <tr>
                <td>Ki√™nKuro</td>
                <td><span class="counter" data-count="2">0</span></td>
                <td><span class="counter" data-count="4">0</span></td>
                <td><span class="counter" data-count="4">0</span></td>
                <td>0</td>
                <td><span class="counter" data-count="160">0</span></td>
                <td><span class="counter" data-count="163">0</span></td>
                <td>-3</td>
              </tr>
              <tr>
                <td>AnKuro</td>
                <td><span class="counter" data-count="1">0</span></td>
                <td><span class="counter" data-count="2">0</span></td>
                <td><span class="counter" data-count="5">0</span></td>
                <td>-3</td>
                <td><span class="counter" data-count="139">0</span></td>
                <td><span class="counter" data-count="170">0</span></td>
                <td>-31</td>
              </tr>
              <tr>
                <td>Ho√°nKuro</td>
                <td><span class="counter" data-count="2">0</span></td>
                <td><span class="counter" data-count="4">0</span></td>
                <td><span class="counter" data-count="6">0</span></td>
                <td>-2</td>
                <td><span class="counter" data-count="181">0</span></td>
                <td><span class="counter" data-count="179">0</span></td>
                <td>+2</td>
              </tr>
            </tbody>
          </table>

          <p class="score-note">
            (Demo) S·ªë li·ªáu minh ho·∫°. B·∫£ng x·∫øp h·∫°ng th·∫≠t n·∫±m ·ªü m·ª•c ‚ÄúB·∫£ng x·∫øp h·∫°ng v√≤ng b·∫£ng‚Äù ph√≠a tr√™n.
          </p>
        </div>

        <div class="glass-card">
          <h3 style="margin-bottom: 10px; font-size: 1.1rem;">Quy t·∫Øc x·∫øp h·∫°ng ƒë·ªÅ xu·∫•t</h3>
          <ul class="rules-list">
            <li><strong>1. ƒêi·ªÉm tr·∫≠n:</strong> Th·∫Øng = 2, thua = 0.</li>
            <li><strong>2. ƒê·ªëi ƒë·∫ßu tr·ª±c ti·∫øp:</strong> N·∫øu ch·ªâ 2 ng∆∞·ªùi b·∫±ng ƒëi·ªÉm.</li>
            <li><strong>3. Hi·ªáu s·ªë set:</strong> Set th·∫Øng - Set thua.</li>
            <li><strong>4. Hi·ªáu s·ªë ƒëi·ªÉm:</strong> ƒêi·ªÉm ghi - ƒêi·ªÉm thua.</li>
            <li><strong>5. B·ªëc thƒÉm / ƒë·∫•u th√™m:</strong> N·∫øu v·∫´n h√≤a.</li>
          </ul>
          <p class="rules-footnote">B·∫°n c√≥ th·ªÉ ch·ªânh quy t·∫Øc theo lu·∫≠t ri√™ng c·ªßa gi·∫£i.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-info">
        <h3>Kuro Open Winter 2026</h3>
        <p>Gi·∫£i c·∫ßu l√¥ng giao l∆∞u ‚Äì fairplay ‚Äì n√¢ng t·∫ßm phong tr√†o c·ªông ƒë·ªìng.</p>
        <p class="copyright">¬© 2026 <strong>AnKuro.</strong> T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u </p>
      </div>

      <div class="footer-contact">
        <h4>Li√™n h·ªá</h4>
        <ul>
          <li><a href="mailto:ankuro@gmail.com"><i class="fa-solid fa-envelope"></i> Email: ankuro@gmail.com</a></li>
          <li><a href="https://zalo.me/" target="_blank"><i class="fa-brands fa-facebook-messenger"></i> Zalo Chat</a>
          </li>
          <li><a href="https://www.facebook.com/hozianw" target="_blank"><i class="fa-brands fa-facebook"></i>
              Facebook</a></li>
          <li><a href="https://www.instagram.com/hozi.anw_/" target="_blank"><i class="fa-brands fa-instagram"></i>
              Instagram</a></li>
        </ul>
      </div>

      <div class="footer-social">
        <h4>K·∫øt n·ªëi nhanh</h4>
        <div class="social-icons">
          <a href="https://www.facebook.com/hozianw" target="_blank"><i class="fa-brands fa-facebook"></i></a>
          <a href="https://www.instagram.com/hozi.anw_/" target="_blank"><i class="fa-brands fa-instagram"></i></a>
          <a href="https://zalo.me/" target="_blank"><i class="fa-brands fa-facebook-messenger"></i></a>
          <a href="mailto:ankuro@gmail.com" target="_blank"><i class="fa-solid fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // =========================
    // COUNTDOWN (SAFE) - T·∫æT 2026
    // =========================
    (() => {
      const countdownContainer = document.getElementById("countdown");
      if (!countdownContainer) return; // kh√¥ng c√≥ #countdown th√¨ b·ªè qua, tr√°nh crash to√†n b·ªô script

      // M√πng 1 T·∫øt B√≠nh Ng·ªç 2026: 17/02/2026 (gi·ªù VN/TH +07:00)
      // N·∫øu b·∫°n mu·ªën ƒë·∫øm t·ªõi GIAO TH·ª™A, ƒë·ªïi th√†nh: "2026-02-16T23:59:59+07:00"
      const eventDate = new Date("2026-02-17T00:00:00+07:00");

      function createSegment(value, label) {
        const seg = document.createElement("div");
        seg.className = "count-segment";
        const num = document.createElement("span");
        num.className = "count-number";
        num.textContent = value;
        const lab = document.createElement("span");
        lab.className = "count-label";
        lab.textContent = label;
        seg.appendChild(num);
        seg.appendChild(lab);
        return seg;
      }

      function renderCountdown() {
        const now = new Date();
        const diff = eventDate - now;

        countdownContainer.innerHTML = "";

        if (diff <= 0) {
          countdownContainer.textContent = "Ch√∫c m·ª´ng nƒÉm m·ªõi AE KURO! V√†o s√¢n th√¥i!";
          countdownContainer.style.fontWeight = "600";
          return;
        }

        const totalSeconds = Math.floor(diff / 1000);
        const days = Math.floor(totalSeconds / (24 * 3600));
        const hours = Math.floor((totalSeconds % (24 * 3600)) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        countdownContainer.appendChild(createSegment(days.toString().padStart(2, "0"), "Ng√†y"));
        countdownContainer.appendChild(createSegment(hours.toString().padStart(2, "0"), "Gi·ªù"));
        countdownContainer.appendChild(createSegment(minutes.toString().padStart(2, "0"), "Ph√∫t"));
        countdownContainer.appendChild(createSegment(seconds.toString().padStart(2, "0"), "Gi√¢y"));
      }

      renderCountdown();
      setInterval(renderCountdown, 1000);
    })();

    // Smooth scroll for nav
    document.querySelectorAll('a[href^="#"]').forEach((link) => {
      link.addEventListener("click", (e) => {
        const targetId = link.getAttribute("href");
        const target = document.querySelector(targetId);
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
    });

    // Fade-in on scroll
    const fadeEls = document.querySelectorAll(".fade-in");
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.18 }
    );
    fadeEls.forEach((el) => observer.observe(el));

    // Counter demo
    let countersStarted = false;
    const counters = document.querySelectorAll(".counter");

    function startCounters() {
      if (countersStarted) return;
      countersStarted = true;

      counters.forEach((el) => {
        const target = parseInt(el.dataset.count, 10) || 0;
        let current = 0;
        const steps = 60;
        const increment = target / steps;

        const interval = setInterval(() => {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(interval);
          }
          el.textContent = Math.round(current);
        }, 18);
      });
    }

    const scoreSection = document.querySelector("#scoring");
    const scoreObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            startCounters();
            scoreObserver.disconnect();
          }
        });
      },
      { threshold: 0.25 }
    );
    if (scoreSection) scoreObserver.observe(scoreSection);

    // =========================
    // APP: LIVE SCOREBOARD
    // =========================
    document.addEventListener("DOMContentLoaded", () => {
      const STORAGE_KEY = "kuro_open_winter_2026_v3";

      // ======= CONFIG: ƒë·ªïi theo b·∫°n =======
      const ADMIN_PIN = "2005"; // ƒë·ªïi PIN
      const ADMIN_KEY = "kuro_admin_unlocked";

      // Sync t·ª´ Google Sheet (tu·ª≥ ch·ªçn)
      const SHEET_ID = "1eaundnDhT_a7r8vC9mj0VqtLAWwUaKKFuhrrWdfZVEw";
      const SHEET_NAME = "1";
      const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

      const players = ["AnKuro", "ƒê·ª©cKuro", "Ki√™nKuro", "Ho√°nKuro", "QuangKuro"];

      const $ = (id) => document.getElementById(id);

      // ======= ADMIN =======
      function isAdmin() { return sessionStorage.getItem(ADMIN_KEY) === "1"; }
      function setAdmin(on) {
        sessionStorage.setItem(ADMIN_KEY, on ? "1" : "0");
        renderAll(); // quan tr·ªçng: re-render ƒë·ªÉ b·ªè disabled ngay l·∫≠p t·ª©c
      }


      // ======= HELPERS =======
      function parseSet(str) {
        if (!str || !str.trim()) return null;
        const m = str.trim().match(/^(\d{1,2})\s*-\s*(\d{1,2})$/);
        if (!m) return null;
        return [Number(m[1]), Number(m[2])];
      }

      function isValidGameScore(a, b) {
        if (!Number.isInteger(a) || !Number.isInteger(b)) return false;
        if (a < 0 || b < 0 || a > 30 || b > 30) return false;
        if (a === b) return false;

        const max = Math.max(a, b);
        const min = Math.min(a, b);
        const diff = max - min;

        if (max < 21) return false;
        if (max === 30) return (min === 29);
        if (max >= 21 && max <= 29) {
          if (min <= 19) return max === 21;
          return diff === 2;
        }
        return false;
      }

      function bestOf3Winner(sets) {
        let winA = 0, winB = 0;
        for (const s of sets) {
          if (!s) continue;
          if (s[0] > s[1]) winA++;
          else winB++;
        }
        if (winA >= 2) return "A";
        if (winB >= 2) return "B";
        return null;
      }

      function sumPoints(sets) {
        let a = 0, b = 0;
        for (const s of sets) {
          if (!s) continue;
          a += s[0]; b += s[1];
        }
        return [a, b];
      }

      // ======= ROUND ROBIN =======
      function generateRoundRobin(list) {
        const arr = [...list];
        if (arr.length % 2 === 1) arr.push("BYE");

        const N = arr.length;
        const rounds = N - 1;
        const half = N / 2;

        let rotating = [...arr];
        const out = [];

        for (let r = 0; r < rounds; r++) {
          const pairs = [];
          for (let i = 0; i < half; i++) {
            const a = rotating[i];
            const b = rotating[N - 1 - i];
            if (a !== "BYE" && b !== "BYE") pairs.push([a, b]);
          }
          out.push(pairs);

          const fixed = rotating[0];
          const rest = rotating.slice(1);
          rest.unshift(rest.pop());
          rotating = [fixed, ...rest];
        }
        return out;
      }

      // ======= STATE =======
      function buildInitialMatches() {
        const rr = generateRoundRobin(players);
        const groupMatches = [];
        let idCounter = 1;

        rr.forEach((pairs, idx) => {
          const roundNo = idx + 1;
          pairs.forEach(([a, b]) => {
            groupMatches.push({
              id: `G${idCounter++}`,
              stage: "GROUP",
              round: roundNo,
              a, b,
              sets: [null, null, null],
              winner: null,
              note: ""
            });
          });
        });

        return {
          matches: groupMatches,
          playoff: { semis: [], final: [], third: [] },
          groupLocked: false,
          seedTop4: null,
          lastSyncAt: null
        };
      }

      function loadState() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return buildInitialMatches();
        try {
          const st = JSON.parse(raw);
          if (!st.matches || !Array.isArray(st.matches)) return buildInitialMatches();
          return st;
        } catch {
          return buildInitialMatches();
        }
      }

      let state = loadState();

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      // ======= STANDINGS =======
      function computeStandings() {
        const table = new Map();
        players.forEach(p => table.set(p, { player: p, mp: 0, w: 0, l: 0, sw: 0, sl: 0, pf: 0, pa: 0 }));

        const groupMatches = state.matches.filter(m => m.stage === "GROUP");

        for (const m of groupMatches) {
          if (!m.winner) continue;
          const A = table.get(m.a);
          const B = table.get(m.b);

          let setWinA = 0, setWinB = 0;
          for (const s of m.sets) {
            if (!s) continue;
            if (s[0] > s[1]) setWinA++;
            else setWinB++;
          }

          A.sw += setWinA; A.sl += setWinB;
          B.sw += setWinB; B.sl += setWinA;

          const [pa, pb] = sumPoints(m.sets);
          A.pf += pa; A.pa += pb;
          B.pf += pb; B.pa += pa;

          if (m.winner === "A") { A.w++; B.l++; A.mp += 2; }
          else { B.w++; A.l++; B.mp += 2; }
        }

        let rows = [...table.values()].map(r => ({ ...r, sd: r.sw - r.sl, pd: r.pf - r.pa }));

        function headToHeadWinner(p1, p2) {
          const h2h = groupMatches.find(x =>
            (x.a === p1 && x.b === p2) || (x.a === p2 && x.b === p1)
          );
          if (!h2h || !h2h.winner) return null;
          if (h2h.a === p1 && h2h.winner === "A") return p1;
          if (h2h.b === p1 && h2h.winner === "B") return p1;
          return p2;
        }

        rows.sort((x, y) => {
          if (y.mp !== x.mp) return y.mp - x.mp;

          const tied = rows.filter(r => r.mp === x.mp);
          if (tied.length === 2) {
            const w = headToHeadWinner(tied[0].player, tied[1].player);
            if (w) return (w === y.player) ? 1 : -1;
          }

          if (y.sd !== x.sd) return y.sd - x.sd;
          if (y.pd !== x.pd) return y.pd - x.pd;
          if (y.pf !== x.pf) return y.pf - x.pf;
          return x.player.localeCompare(y.player);
        });

        return rows;
      }

      function groupCompleted() {
        return state.matches.filter(m => m.stage === "GROUP").every(m => m.winner !== null);
      }

      // ======= PLAYOFF =======
      function ensurePlayoffs() {
        if (!groupCompleted()) return;

        const standings = computeStandings();
        const top4 = (state.groupLocked && Array.isArray(state.seedTop4))
          ? state.seedTop4
          : standings.slice(0, 4).map(r => r.player);

        const [s1, s2, s3, s4] = top4;

        const existing = state.playoff?.semis?.length ? state.playoff : { semis: [], final: [], third: [] };

        const semis = [
          existing.semis?.[0] ?? { id: "S1", stage: "SEMI", round: 1, a: s1, b: s4, sets: [null, null, null], winner: null, note: "" },
          existing.semis?.[1] ?? { id: "S2", stage: "SEMI", round: 1, a: s2, b: s3, sets: [null, null, null], winner: null, note: "" },
        ];
        semis[0].a = s1; semis[0].b = s4;
        semis[1].a = s2; semis[1].b = s3;

        const final = existing.final?.[0] ?? { id: "F1", stage: "FINAL", round: 1, a: "TBD", b: "TBD", sets: [null, null, null], winner: null, note: "" };
        const third = existing.third?.[0] ?? { id: "T1", stage: "THIRD", round: 1, a: "TBD", b: "TBD", sets: [null, null, null], winner: null, note: "" };

        const semiWinners = semis.map(m => m.winner ? (m.winner === "A" ? m.a : m.b) : null);
        const semiLosers = semis.map(m => m.winner ? (m.winner === "A" ? m.b : m.a) : null);

        if (semiWinners.every(Boolean)) {
          final.a = semiWinners[0];
          final.b = semiWinners[1];
        } else {
          final.a = "TBD"; final.b = "TBD";
          final.sets = [null, null, null]; final.winner = null; final.note = "";
        }

        if (semiLosers.every(Boolean)) {
          third.a = semiLosers[0];
          third.b = semiLosers[1];
        } else {
          third.a = "TBD"; third.b = "TBD";
          third.sets = [null, null, null]; third.winner = null; third.note = "";
        }

        state.playoff = { semis, final: [final], third: [third] };
      }

      // ======= RENDER HELPERS =======
      function stageLabel(stage) {
        if (stage === "GROUP") return "V√≤ng b·∫£ng";
        if (stage === "SEMI") return "B√°n k·∫øt";
        if (stage === "FINAL") return "Chung k·∫øt";
        if (stage === "THIRD") return "H·∫°ng 3";
        return stage;
      }

      function formatSets(sets, idx) {
        const s = sets[idx];
        return s ? `${s[0]}-${s[1]}` : "-";
      }

      function winnerName(m) {
        if (!m.winner) return "";
        return m.winner === "A" ? m.a : m.b;
      }

      function listAllMatches() {
        return [
          ...state.matches,
          ...(state.playoff?.semis ?? []),
          ...(state.playoff?.final ?? []),
          ...(state.playoff?.third ?? []),
        ];
      }

      function findMatchById(id) {
        return listAllMatches().find(m => m.id === id) || null;
      }

      function updateMatchById(id, patch) {
        const gi = state.matches.findIndex(m => m.id === id);
        if (gi >= 0) {
          state.matches[gi] = { ...state.matches[gi], ...patch };
          return;
        }
        for (const key of ["semis", "final", "third"]) {
          const arr = state.playoff?.[key];
          const idx = arr?.findIndex(m => m.id === id) ?? -1;
          if (idx >= 0) {
            state.playoff[key][idx] = { ...state.playoff[key][idx], ...patch };
            return;
          }
        }
      }

      function nextMatchId(allMatches) {
        return allMatches.find(m => !m.winner && m.a !== "TBD" && m.b !== "TBD")?.id ?? null;
      }

      // ======= FILTER =======
      function setupFilter() {
        const sel = $("player-filter");
        if (!sel) return;
        sel.innerHTML = `<option value="ALL">T·∫•t c·∫£ VƒêV</option>` + players.map(p => `<option value="${p}">${p}</option>`).join("");
        sel.addEventListener("change", () => renderAll());
      }

      function passFilter(match) {
        const f = $("player-filter")?.value ?? "ALL";
        if (f === "ALL") return true;
        return match.a === f || match.b === f;
      }

      // ======= RENDER SCOREBOARD =======
      function renderScoreboard() {
        const tbody = $("score-data");
        const all = listAllMatches().filter(passFilter);
        const nextId = nextMatchId(all);

        tbody.innerHTML = all.map(m => {
          const isNext = m.id === nextId;
          const rowStyle = isNext ? `style="outline:2px solid rgba(255,255,255,.22);"` : "";

          const isTBD = (m.a === "TBD" || m.b === "TBD");
          const isLockedGroup = (state.groupLocked && m.stage === "GROUP");
          const canEdit = isAdmin() && !isTBD && !isLockedGroup;

          const noteText = m.note || (isNext ? " Tr·∫≠n k·∫ø ti·∫øp" : "-");
          const win = winnerName(m);

          return `
            <tr ${rowStyle}>
              <td data-label="Giai ƒëo·∫°n">${stageLabel(m.stage)}</td>
              <td data-label="V√≤ng">${m.stage === "GROUP" ? `V√≤ng ${m.round}` : "-"}</td>
              <td data-label="Tr·∫≠n"><strong>${m.a}</strong> vs <strong>${m.b}</strong></td>
              <td data-label="Set 1"><strong>${formatSets(m.sets, 0)}</strong></td>
              <td data-label="Set 2"><strong>${formatSets(m.sets, 1)}</strong></td>
              <td data-label="Set 3"><strong>${formatSets(m.sets, 2)}</strong></td>
              <td data-label="Ng∆∞·ªùi th·∫Øng">${win ? `<span class="winner-label">${win}</span>` : "-"}</td>
              <td data-label="Ghi ch√∫">${noteText}</td>
              <td data-label="Thao t√°c" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <button type="button" class="btn ghost" data-edit="${m.id}" ${canEdit ? "" : "disabled"}>Nh·∫≠p</button>
                <button type="button" class="btn ghost" data-clear="${m.id}" ${canEdit ? "" : "disabled"}>Xo√°</button>
              </td>
            </tr>
          `;
        }).join("");

        if (!tbody.innerHTML.trim()) {
          tbody.innerHTML = `<tr><td colspan="9">Kh√¥ng c√≥ tr·∫≠n n√†o theo b·ªô l·ªçc hi·ªán t·∫°i.</td></tr>`;
        }
      }

      // ======= RENDER STANDINGS =======
      function renderStandings() {
        const body = $("standings-body");
        const rows = computeStandings();

        body.innerHTML = rows.map((r, i) => `
          <tr>
            <td>${i + 1}</td>
            <td><strong>${r.player}</strong></td>
            <td>${r.mp}</td>
            <td>${r.w}</td>
            <td>${r.l}</td>
            <td>${r.sw}</td>
            <td>${r.sl}</td>
            <td class="${r.sd > 0 ? "score-highlight" : ""}">${r.sd}</td>
            <td>${r.pf}</td>
            <td>${r.pa}</td>
            <td class="${r.pd > 0 ? "score-highlight" : ""}">${r.pd}</td>
          </tr>
        `).join("");
      }

      // ======= RENDER BRACKET =======
      // ======= RENDER BRACKET =======
      function renderBracket() {
        ensurePlayoffs();

        const semisWrap = $("semis-wrap");
        const finalWrap = $("final-wrap");
        const thirdWrap = $("third-wrap");

        function matchCard(m) {
          const setsText = m.sets.map(s => (s ? `${s[0]}-${s[1]}` : "-")).join(" | ");
          const win = winnerName(m);
          const isTBD = (m.a === "TBD" || m.b === "TBD");
          const canEdit = isAdmin() && !isTBD;

          return `
      <div class="glass-card" style="margin-bottom:10px; padding:12px;">
        <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start; flex-wrap:wrap;">
          <div>
            <div style="opacity:.85; font-size:.9rem;">${m.id}</div>
            <div style="font-size:1.05rem; margin-top:2px;">
              <strong>${m.a}</strong> vs <strong>${m.b}</strong>
            </div>
            <div style="margin-top:6px; opacity:.9;">Set: ${setsText}</div>
            <div style="margin-top:6px;">Th·∫Øng: ${win ? `<span class="winner-label">${win}</span>` : "-"}</div>
            <div style="margin-top:6px; opacity:.9;">Ghi ch√∫: ${m.note || "-"}</div>
          </div>

          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button type="button" class="btn ghost" data-edit="${m.id}" ${canEdit ? "" : "disabled"}>Nh·∫≠p</button>
            <button type="button" class="btn ghost" data-clear="${m.id}" ${canEdit ? "" : "disabled"}>Xo√°</button>
          </div>
        </div>
      </div>
    `;
        }

        const semis = state.playoff?.semis ?? [];
        const final = state.playoff?.final ?? [];
        const third = state.playoff?.third ?? [];

        semisWrap.innerHTML = semis.length ? semis.map(matchCard).join("") : `<div style="opacity:.85;">Ch∆∞a c√≥ d·ªØ li·ªáu b√°n k·∫øt.</div>`;
        finalWrap.innerHTML = final.length ? final.map(matchCard).join("") : `<div style="opacity:.85;">Ch∆∞a c√≥ d·ªØ li·ªáu chung k·∫øt.</div>`;
        thirdWrap.innerHTML = third.length ? third.map(matchCard).join("") : `<div style="opacity:.85;">Ch∆∞a c√≥ d·ªØ li·ªáu h·∫°ng 3.</div>`;
      }

      // ======= STATUS / UI =======
      function fmtTime(ts) {
        if (!ts) return "-";
        try {
          return new Date(ts).toLocaleString("vi-VN");
        } catch {
          return "-";
        }
      }

      function updateStatusPill() {
        const el = $("status-pill");
        if (!el) return;

        const adminTxt = isAdmin() ? "Admin: M·ªü" : "Admin: Kho√°";
        const lockTxt = state.groupLocked ? "Ch·ªët v√≤ng b·∫£ng: B·∫≠t" : "Ch·ªët v√≤ng b·∫£ng: T·∫Øt";
        const syncTxt = state.lastSyncAt ? `Sync: ${fmtTime(state.lastSyncAt)}` : "Sync: -";

        el.innerHTML = `
    <span>${adminTxt}</span>
    <span style="opacity:.6;">‚Ä¢</span>
    <span>${lockTxt}</span>
    <span style="opacity:.6;">‚Ä¢</span>
    <span>${syncTxt}</span>
  `;
      }

      function updateAdminUI() {
        const btnAdmin = $("btn-admin");
        const btnLock = $("btn-lock");
        const btnReset = $("btn-reset");
        const btnExport = $("btn-export");
        const btnSync = $("btn-sync");

        const canAdmin = isAdmin();

        if (btnAdmin) {
          btnAdmin.textContent = canAdmin ? "Admin: M·ªü" : "Admin: Kho√°";
          btnAdmin.disabled = false;     // <<< QUAN TR·ªåNG: lu√¥n cho b·∫•m
          btnAdmin.style.opacity = "";   // <<< lu√¥n r√µ
        }

        if (btnLock) btnLock.textContent = `Ch·ªët v√≤ng b·∫£ng: ${state.groupLocked ? "B·∫≠t" : "T·∫Øt"}`;

        // Ch·ªâ disable c√°c n√∫t kh√°c (kh√¥ng disable btnAdmin)
        [btnLock, btnReset, btnExport, btnSync].forEach(b => {
          if (!b) return;
          b.disabled = !canAdmin;
          b.style.opacity = canAdmin ? "" : "0.55";
        });

        updateStatusPill();
      }


      // ======= MODAL: INPUT SCORE =======
      const dlg = $("score-dialog");
      const dlgTitle = $("dlg-title");
      const dlgSub = $("dlg-sub");
      const dlgErr = $("dlg-error");
      const inS1 = $("s1");
      const inS2 = $("s2");
      const inS3 = $("s3");
      const inNote = $("note");
      const selType = $("result-type");
      const selForced = $("forced-winner");
      const btnClearDlg = $("dlg-clear");
      const btnSaveDlg = $("dlg-save");

      let currentMatchId = null;

      function showDlgError(msg) {
        if (!dlgErr) return;
        dlgErr.style.display = msg ? "block" : "none";
        dlgErr.textContent = msg || "";
      }

      function openScoreDialog(matchId) {
        const m = findMatchById(matchId);
        if (!m) return;

        // ch·∫∑n nh·∫≠p n·∫øu b·ªã kho√° (v√≤ng b·∫£ng) ho·∫∑c ch∆∞a admin
        if (!isAdmin()) return;
        if (state.groupLocked && m.stage === "GROUP") return;
        if (m.a === "TBD" || m.b === "TBD") return;

        currentMatchId = matchId;

        if (dlgTitle) dlgTitle.textContent = `Nh·∫≠p t·ªâ s·ªë ‚Ä¢ ${m.id}`;
        if (dlgSub) dlgSub.textContent = `${stageLabel(m.stage)} ‚Ä¢ ${m.a} vs ${m.b}`;

        // fill
        inS1.value = m.sets?.[0] ? `${m.sets[0][0]}-${m.sets[0][1]}` : "";
        inS2.value = m.sets?.[1] ? `${m.sets[1][0]}-${m.sets[1][1]}` : "";
        inS3.value = m.sets?.[2] ? `${m.sets[2][0]}-${m.sets[2][1]}` : "";

        inNote.value = m.note || "";
        selType.value = "NORMAL";
        selForced.value = "A";
        showDlgError("");

        if (dlg && typeof dlg.showModal === "function") dlg.showModal();
      }

      function clearMatch(matchId) {
        const m = findMatchById(matchId);
        if (!m) return;
        if (!isAdmin()) return;
        if (state.groupLocked && m.stage === "GROUP") return;
        if (m.a === "TBD" || m.b === "TBD") return;

        updateMatchById(matchId, { sets: [null, null, null], winner: null, note: "" });
        ensurePlayoffs();
        saveState();
        renderAll();
      }

      function applyResultToMatch(m, sets, resultType, forcedWinner, note) {
        // resultType: NORMAL | WO | RET
        // winner: d·ª±a v√†o sets ho·∫∑c forcedWinner
        let winner = null;

        if (resultType === "NORMAL") {
          winner = bestOf3Winner(sets);
          if (!winner) throw new Error("Ch∆∞a x√°c ƒë·ªãnh ƒë∆∞·ª£c ng∆∞·ªùi th·∫Øng. H√£y nh·∫≠p ƒë·ªß set h·ª£p l·ªá (Bo3).");
        } else {
          // WO/RET: b·∫Øt bu·ªôc ch·ªçn winner
          winner = forcedWinner === "B" ? "B" : "A";

          // N·∫øu ng∆∞·ªùi d√πng kh√¥ng nh·∫≠p set, ta auto 21-0, 21-0 ƒë·ªÉ BXH c√≥ HS set/ƒëi·ªÉm
          const hasAnySet = sets.some(s => s && (s[0] !== undefined));
          if (!hasAnySet) {
            if (winner === "A") sets = [[21, 0], [21, 0], null];
            else sets = [[0, 21], [0, 21], null];
          }
        }

        // Patch
        updateMatchById(m.id, {
          sets,
          winner,
          note: note || (resultType !== "NORMAL" ? resultType : "")
        });
      }

      // Validate NORMAL: t·ª´ng set theo lu·∫≠t 21 (deuce ƒë·∫øn 30)
      function validateNormalSets(sets) {
        const present = sets.filter(Boolean);
        if (present.length < 2) throw new Error("Thi·∫øu d·ªØ li·ªáu: t·ªëi thi·ªÉu ph·∫£i c√≥ Set 1 v√† Set 2.");

        // validate t·ª´ng set
        present.forEach((s, idx) => {
          const ok = isValidGameScore(s[0], s[1]);
          if (!ok) throw new Error(`Set ${idx + 1} kh√¥ng h·ª£p l·ªá (${s[0]}-${s[1]}).`);
        });

        const w = bestOf3Winner(sets);
        if (!w) throw new Error("Ch∆∞a ƒë·ªß 2 set th·∫Øng ƒë·ªÉ k·∫øt lu·∫≠n tr·∫≠n (Bo3).");

        // N·∫øu ƒë√£ 2-0 th√¨ set3 n√™n ƒë·ªÉ tr·ªëng
        let winA = 0, winB = 0;
        for (const s of sets) {
          if (!s) continue;
          if (s[0] > s[1]) winA++;
          else winB++;
        }
        if ((winA === 2 || winB === 2) && sets[2]) {
          // v·∫´n cho ph√©p, nh∆∞ng th∆∞·ªùng kh√¥ng c·∫ßn
        }
      }

      function onSaveDialog() {
        const m = findMatchById(currentMatchId);
        if (!m) return;

        try {
          const s1 = parseSet(inS1.value);
          const s2 = parseSet(inS2.value);
          const s3 = parseSet(inS3.value);

          const resultType = selType.value;
          const forced = selForced.value;
          const note = (inNote.value || "").trim();

          const sets = [s1, s2, s3];

          if (resultType === "NORMAL") {
            validateNormalSets(sets);
          } else {
            // WO/RET: n·∫øu ng∆∞·ªùi d√πng c√≥ nh·∫≠p set th√¨ ki·ªÉm tra format (parseSet ƒë√£ l√†m)
            // v√† n·∫øu c√≥ ƒëi·ªÉm th√¨ c≈©ng validate theo lu·∫≠t game (ƒë·ªÉ tr√°nh nh·∫≠p 100-0)
            sets.filter(Boolean).forEach((s, idx) => {
              if (!isValidGameScore(s[0], s[1])) {
                throw new Error(`Set ${idx + 1} kh√¥ng h·ª£p l·ªá (${s[0]}-${s[1]}).`);
              }
            });
          }

          applyResultToMatch(m, sets, resultType, forced, note);

          ensurePlayoffs();
          saveState();
          renderAll();

          if (dlg) dlg.close();
        } catch (e) {
          showDlgError(e?.message || "L·ªói d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra l·∫°i.");
        }
      }

      // ======= EXPORT / IMPORT =======
      function exportJson() {
        const data = JSON.stringify(state, null, 2);
        const blob = new Blob([data], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "kuro_open_winter_2026.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      function importJsonFile(file) {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const obj = JSON.parse(String(reader.result || ""));
            if (!obj || !Array.isArray(obj.matches)) throw new Error("File JSON kh√¥ng ƒë√∫ng c·∫•u tr√∫c.");
            state = obj;
            saveState();
            renderAll();
          } catch (e) {
            alert(e?.message || "Kh√¥ng import ƒë∆∞·ª£c JSON.");
          }
        };
        reader.readAsText(file);
      }

      // ======= SYNC GOOGLE SHEET (GVIZ) =======
      // G·ª£i √Ω c·∫•u tr√∫c sheet (linh ho·∫°t):
      // A: id, B: stage, C: a, D: b, E: set1, F: set2, G: set3, H: winner(optional), I: note(optional)
      // winner c√≥ th·ªÉ ƒë·ªÉ tr·ªëng -> auto theo set.
      function safeGvizJson(text) {
        // GVIZ tr·∫£ v·ªÅ: google.visualization.Query.setResponse({...});
        const start = text.indexOf("{");
        const end = text.lastIndexOf("}");
        if (start < 0 || end < 0) throw new Error("Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu GVIZ.");
        return JSON.parse(text.slice(start, end + 1));
      }

      function deriveWinnerFromSets(sets) {
        const w = bestOf3Winner(sets);
        return w; // "A"/"B"/null
      }

      async function syncFromSheet() {
        try {
          const res = await fetch(SHEET_URL, { cache: "no-store" });
          const text = await res.text();
          const json = safeGvizJson(text);

          const rows = json?.table?.rows || [];
          if (!rows.length) throw new Error("Sheet kh√¥ng c√≥ d·ªØ li·ªáu.");

          const col = (r, i) => (r?.c?.[i]?.v ?? "").toString().trim();

          // Build map current matches
          const all = listAllMatches();
          const map = new Map(all.map(m => [m.id, m]));

          let updated = 0;

          for (const r of rows) {
            const id = col(r, 0);
            if (!id) continue;
            if (!map.has(id)) continue;

            const m = map.get(id);

            const stage = col(r, 1) || m.stage;
            const a = col(r, 2) || m.a;
            const b = col(r, 3) || m.b;

            const s1 = parseSet(col(r, 4));
            const s2 = parseSet(col(r, 5));
            const s3 = parseSet(col(r, 6));
            const sets = [s1, s2, s3];

            // winner: n·∫øu sheet c√≥ c·ªôt th√¨ ∆∞u ti√™n, kh√¥ng th√¨ auto theo set
            const wRaw = col(r, 7);
            let winner = null;
            if (wRaw) {
              if (wRaw === "A" || wRaw === "B") winner = wRaw;
              else if (wRaw === a) winner = "A";
              else if (wRaw === b) winner = "B";
            }
            if (!winner) winner = deriveWinnerFromSets(sets);

            const note = col(r, 8) || "";

            // Update
            updateMatchById(id, { stage, a, b, sets, winner, note });
            updated++;
          }

          state.lastSyncAt = Date.now();
          ensurePlayoffs();
          saveState();
          renderAll();

          alert(`Sync OK: c·∫≠p nh·∫≠t ${updated} d√≤ng (theo ID kh·ªõp).`);
        } catch (e) {
          alert(e?.message || "Sync th·∫•t b·∫°i.");
        }
      }

      // ======= LOCK GROUP =======
      function toggleGroupLock() {
        if (!isAdmin()) return;

        state.groupLocked = !state.groupLocked;
        if (state.groupLocked) {
          // ch·ªët top4 ngay l√∫c b·∫≠t
          const standings = computeStandings();
          state.seedTop4 = standings.slice(0, 4).map(r => r.player);
        } else {
          state.seedTop4 = null;
        }
        saveState();
        renderAll();
      }

      // ======= MAIN RENDER =======
      function renderAll() {
        renderScoreboard();
        renderStandings();
        renderBracket();
        updateAdminUI();
        updateStatusPill();
      }

      // ======= EVENT BINDINGS =======
      function bindEvents() {
        // Delegate click for edit/clear buttons
        document.addEventListener("click", (ev) => {
          const t = ev.target;
          if (!(t instanceof HTMLElement)) return;

          const editId = t.getAttribute("data-edit");
          const clearId = t.getAttribute("data-clear");

          if (editId) {
            openScoreDialog(editId);
          }
          if (clearId) {
            const m = findMatchById(clearId);
            if (!m) return;
            if (!isAdmin()) return;
            if (state.groupLocked && m.stage === "GROUP") return;

            const ok = confirm(`Xo√° t·ªâ s·ªë tr·∫≠n ${m.id} (${m.a} vs ${m.b})?`);
            if (ok) clearMatch(clearId);
          }
        });

        if (btnClearDlg) {
          btnClearDlg.addEventListener("click", () => {
            inS1.value = "";
            inS2.value = "";
            inS3.value = "";
            inNote.value = "";
            selType.value = "NORMAL";
            selForced.value = "A";
            showDlgError("");
          });
        }

        if (btnSaveDlg) {
          btnSaveDlg.addEventListener("click", (e) => {
            // gi·ªØ dialog kh√¥ng t·ª± ƒë√≥ng n·∫øu l·ªói
            e.preventDefault();
            onSaveDialog();
          });
        }

        // Admin button
        const btnAdmin = $("btn-admin");
        if (btnAdmin) {
          btnAdmin.addEventListener("click", () => {
            if (isAdmin()) {
              setAdmin(false);
              return;
            }
            const pin = prompt("Nh·∫≠p Admin PIN:");
            if ((pin ?? "").trim() === ADMIN_PIN) setAdmin(true);
            else alert("Sai PIN.");


          });
        }

        // Lock group
        const btnLock = $("btn-lock");
        if (btnLock) btnLock.addEventListener("click", toggleGroupLock);

        // Reset
        const btnReset = $("btn-reset");
        if (btnReset) {
          btnReset.addEventListener("click", () => {
            if (!isAdmin()) return;
            const ok = confirm("Reset to√†n b·ªô d·ªØ li·ªáu gi·∫£i? (Kh√¥ng th·ªÉ ho√†n t√°c)");
            if (!ok) return;
            state = buildInitialMatches();
            saveState();
            renderAll();
          });
        }

        // Export
        const btnExport = $("btn-export");
        if (btnExport) btnExport.addEventListener("click", () => {
          if (!isAdmin()) return;
          exportJson();
        });

        // Import
        const fileImport = $("file-import");
        if (fileImport) {
          fileImport.addEventListener("change", () => {
            const f = fileImport.files?.[0];
            if (!f) return;
            if (!isAdmin()) {
              alert("C·∫ßn Admin ƒë·ªÉ import.");
              fileImport.value = "";
              return;
            }
            importJsonFile(f);
            fileImport.value = "";
          });
        }

        // Sync
        const btnSync = $("btn-sync");
        if (btnSync) btnSync.addEventListener("click", () => {
          if (!isAdmin()) return;
          syncFromSheet();
        });
      }

      // ======= INIT =======
      setupFilter();
      bindEvents();
      updateAdminUI();
      renderAll();

    }); // <-- ƒê√ìNG document.addEventListener("DOMContentLoaded", ...)

  </script>